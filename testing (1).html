<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- Load d3.js -->
    <script src="http://d3js.org/d3.v6.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <style>
        /* Style for the tooltip */
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font: 12px sans-serif;
            background: lightgray;
            border: 1px solid #aaa;
            border-radius: 5px;
            pointer-events: none;
            opacity: 0;
        }
    </style>
</head>

<body>
    <!-- Tooltip element -->
    <div class="tooltip"></div>
    <svg width="960" height="500"></svg>
    <script>

        // The svg
        const svg = d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        // Map and projection
        const path = d3.geoPath();
        const projection = d3.geoMercator()
            .scale(70)
            .center([0, 20])
            .translate([width / 2, height / 2]);

        // Data and color scale
        const data = new Map();
        const colorScale = d3.scaleThreshold()
            .domain([6.0, 7.0, 8.0, 9.0, 10.0, 11.0, 12.0])
            .range(d3.schemeBlues[7]);
        
        // Tooltip functions
        // Tooltip functions
        function mouseOver(event, d) {
            d3.select(this)
                .transition()
                .duration(200)
                .style("opacity", 1)
                .style("stroke", "black");

            // Show tooltip
            d3.select(".tooltip")
                .html(`<strong>${d.properties.name}</strong><br>Total: ${d.total.toFixed(2)}%`)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 15) + "px")
                .style("opacity", 1);
        }

        function mouseLeave(d) {
            d3.select(this)
                .transition()
                .duration(200)
                .style("opacity", .8)
                .style("stroke", "transparent");

            // Hide tooltip
            d3.select(".tooltip")
                .style("opacity", 0);
        }


        // Load external data and boot
        Promise.all([
            d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
            d3.csv("assets\datasets\1- mental-illnesses-prevalence.csv", function (d) {
                data.set(d.Code, +d.Total)
            })]).then(function (loadData) {
            let topo = loadData[0];

            // Draw the map
            svg.append("g")
                .selectAll("path")
                .data(topo.features)
                .enter()
                .append("path")
                // draw each country
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                // set the color of each country
                .attr("fill", function (d) {
                    d.total = data.get(d.id) || 0;
                    return colorScale(d.total);
                })
                .style("stroke", "transparent")
                .attr("class", function (d) {
                    return "Country"
                })
                .style("opacity", .8)
                .on("mouseover", mouseOver)
                .on("mouseleave", mouseLeave)

        })

        
        </script>

</body>

</html>
